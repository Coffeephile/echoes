define(["jquery","underscore","backbone","views/playlists-viewer/playlist_search","views/playlists-viewer/playlists_list","modules/gsignin/gsignin"],function(e,t,n,r,i,s){var o=n.View.extend({el:"#playlists-viewer",initialize:function(){this.listenTo(n,"app:add-to-playlist",this.show),this.listenTo(this.model.youtube.playlists,"update",this.render),this.listenTo(this.model.youtube.playlists,"added",function(e){this.model.youtube.playlists.list()}),this.$el.on("hidden",t.bind(this.reset,this)),this.$el.on("show",t.bind(this.render,this)),this.header=new r({el:this.$(".modal-header"),model:this.model}),this.playlists=new i({el:this.$(".modal-body ul")}),this.gsignin=new s({el:this.$(".gsign-in")[0],scopes:this.model.user.auth.scopes,clientId:this.model.user.getClientId()}),this.listenTo(this.playlists,"adding",this.addToPlaylist),this.filter="",this.listenTo(this.header,"search:change",this.filterPlaylist),this.listenTo(this.header,"search:add",this.createPlaylist)},render:function(){var e=this.getPlaylistsForDisplay(this.model.youtube.playlists),t=e,n=this.model.youtube.profile.isSignedIn();this.playlists.collection.reset(t,{reset:!0}),this.$el.toggleClass("user-not-signed-in",!n),this.$el.toggleClass("add-new-playlist",!t.length)},getPlaylistsForDisplay:function(e){var t=this.filter,n=e.filter(function(e){return e.getTitle().toLowerCase().indexOf(t)>-1},this);return n.map(function(e){return e.toJSON()})},show:function(e){this.currentVideo=e,this.$el.modal("show")},addToPlaylist:function(e){var t=this.currentVideo.id;this.model.youtube.playlists.insert(e,t),this.model.set("playlist-add",!1,{silent:!0});return},renderGapiResult:function(e){var t="the video has been successfuly added to this playlist.",n=e.id;e.set({message:t,adding:!1},{silent:!0}),this.model.user.playlists.list(n),this.render()},filterPlaylist:function(e){this.filter=e,this.render()},reset:function(){this.$("input[type=search]").val(""),this.playlists.reset(),this.filter=""},createPlaylist:function(e){var t;e.length&&(t=this.model.user.playlists.createPlaylist(e),this.listenTo(t,"sync",function(e){this.header.resetState()}))}});return o});