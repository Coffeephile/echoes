define(["underscore"],function(e){function n(t,n){var r="change";this.uid=t,this.context=n,this.isCollection=!n.set&&n.models&&n.add,e.isNull(this.getData())&&this.storage().setItem(t,this.isCollection?"[]":""),this.isCollection?(n.add(this.getData()),r="add"):n.set(this.getData()),n.on(r,this.store,this)}var t={formatNumberWithComma:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}};return n.prototype={store:function(e){this.storage().setItem(this.uid,JSON.stringify(this.isCollection?e.collection.toJSON():e.toJSON()))},storage:function(){return localStorage},getData:function(){return this._current=this.storage().getItem(this.uid),this._current?JSON.parse(this._current):this._current}},t.Safe=n,t})