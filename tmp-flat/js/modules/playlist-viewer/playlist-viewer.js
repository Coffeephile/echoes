define(["jquery","underscore","backbone","views/youtube_item","models/youtube_item","models/youtube_playlist_info_provider","text!./playlist-viewer.tpl.html"],function(e,t,n,r,i,s,o){var u=n.Collection.extend({model:i}),a=r.extend({initialize:function(){this.listen()},render:function(){var e=this.model.toJSON().video;return(e.status&&e.status.reason==="suspended"||e.status&&e.status.value==="restricted")&&this.$el.hide(),t.extend(this.model.attributes,e),e=this.model.digest().toJSON(),this.$el.html(this.template(e)),this}}),f=n.View.extend({tagName:"ul",className:"clearfix unstyled ux-maker playlist-items",view:{type:a,collection:u,events:{"play-media":"playMedia"}},initialize:function(e){this.options=e},playMedia:function(e){var t=this.model.get("player").get("index"),n;t&&(n=this.collection.at(t),n&&n.set({isPlaying:!1})),this.model.playMedia({type:"playlist",mediaId:this.options.info.get("id"),index:e.get("position")-1})}}),l=n.View.extend({template:o,render:function(){this.$el.html(t.template(this.template,this.model.toJSON()))}}),c=n.View.extend({tagName:"div",transition:{duration:200,css:"transition-in"},initialize:function(){this.info=new s,this.infoView=new l({model:this.info}),this.items=new f({model:this.model,info:this.info}),this.$el.append([this.infoView.el,this.items.el]),this.listenTo(this.model.youtube,"change:showPlaylistId",this.getPlaylistInfo),this.listenTo(n,"app:load-more",this.handleLoadMore),this.listenTo(this.info,"done",this.renderItems),n.trigger("app:loader-start"),this.getPlaylistInfo()},getPlaylistInfo:function(){this.info.set("id",this.model.youtube.get("showPlaylistId"))},renderItems:function(e){var r=!1;n.trigger("app:loader-end"),this.items.collection.set(t.chain(e).filter(function(e){var t=e&&e.video,n=t&&e.video.status&&e.video.status,r="private blocked suspended";if(n&&r.indexOf(n.reason)>-1)return!1;if(t)return e}).value()),r=this.info.get("totalItems")!==this.items.collection.length-1,this.info.set({totalItems:this.items.collection.length,restricted:r}),this.info.sourceItems=e,this.infoView.render()}});return c});