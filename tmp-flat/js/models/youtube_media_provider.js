define(["underscore","backbone","./youtube_item_info","./youtube_playlist_info_provider","./youtube/ProfileService","./youtube/playlist-items","collections/youtube/UserPlaylists"],function(e,t,n,r,i,s,o){var u="AI39si4_o0x9AELkUm2d2M30xfHzbgEjFtZgzV8C7Ydu2f6eRZ6XaYaRxD07qwEVBQkMiOK0pwOFbQ4M7sWl6jcJ7r102BsRJg",a=t.Model.extend({playlists:new o,profile:new i,history:new s,defaults:{query:"",startIndex:1,maxResults:50,data:[],preset:"",duration:"",feedType:"videos"},info:new n,playlist:new r,safe:"echoesYoutubeProvider",initialize:function(){this.attributes.data.length=0,this.on("change:feedType",this.resetIndexAndSearch,this),this.on("change:query",this.resetIndexAndSearch,this),this.on("change:startIndex",this.search,this),this.on("change:preset",this.resetIndexAndSearch,this),this.listenTo(this.profile,"loaded",this.updateLists)},updateLists:function(e){this.history.setId(e.watchHistory)},resetIndexAndSearch:function(){this.set({startIndex:1},{silent:!0}),this.fetch()},search:function(){this.fetch()},fetchNext:function(){var e=this.get("startIndex"),t=this.get("data").totalItems,n=e+this.get("data").itemsPerPage,r=t-n;r>0&&this.set("startIndex",n,{silent:!0}),this.fetch()},query:function(e){e.startIndex=e.startIndex||1,this.set(e)},urlRoot:function(){var e=this.attributes.preset?""+this.attributes.preset.value:"",t=["https://gdata.youtube.com/feeds/api/",this.getFeedType(),"?q=",this.attributes.query,e,"&alt=jsonc&v=2&start-index=",this.attributes.startIndex,this.attributes.duration&&this.attributes.duration.value?"&duration="+this.attributes.duration.value:"","&max-results=",this.attributes.maxResults,"&key=",u];return t.join("")},getFeedType:function(){var e=this.get("feedType");return e==="playlists"&&(e+="/snippets"),e==="playlist"&&(e+="/"+this.get("query")),e},validate:function(e){if(e.startIndex<0)return"start index should be greater than 1."},fetchMediaById:function(e){this.info.set("id",e)},fetchPlaylistInfo:function(e){this.playlist.set("id",e)},nextIndex:function(){var e=this.get("startIndex"),t=this.get("data").totalItems,n=e+this.get("data").itemsPerPage,r=t-n;r>0&&this.set("startIndex",n)},prevIndex:function(){var e=this.get("startIndex")-this.get("data").itemsPerPage;e>-1&&this.set("startIndex",e)}});return a});